# logibooks.ext

Расширение Chrome для генератора документации

Расширение Chrome Manifest V3, которое:
- переходит по URL из очереди заданий, управляемой сервером,
- предлагает пользователю выбрать прямоугольную область в видимой области просмотра,
- захватывает и обрезает выбранную область,
- загружает полученное изображение обратно на сервер,
- повторяет процесс до получения маркера завершения.

Репозиторий включает **локальный сервер симуляции** для разработки и тестирования.

---

## Компоненты

### 1. Расширение Chrome (`/ext`)
- Manifest V3
- Захват видимой области с использованием `chrome.tabs.captureVisibleTab`
- Выбор прямоугольной области пользователем (overlay с перетаскиванием)
- Обрезка через `OffscreenCanvas`
- Загрузка через `fetch` + `multipart/form-data`

### 2. Сервер симуляции (`/sim-server`)
- Node.js + Express
- Предоставляет очередь URL из списка разрешённых
- Принимает загруженные скриншоты
- Хранит изображения и метаданные локально

---

## Требования

- Chrome (последняя стабильная версия)
- Node.js ≥ 18

---

## Запуск сервера симуляции

```bash
cd sim-server
npm install
npm start
```

Сервер будет:
- Слушать на `http://localhost:5177` по умолчанию
- Предоставлять endpoint `/jobs`, возвращающий следующий URL для посещения
- Принимать загрузки на `/upload/:key`

---

## Архитектура расширения

### Ключевые файлы
- Манифест расширения: [ext/manifest.json](ext/manifest.json)
- UI / взаимодействие со страницей: [ext/content.js](ext/content.js#L1)
- Фоновая работа (service worker): [ext/sw.js](ext/sw.js#L1)

### Дизайн
- `content.js` отвечает только за DOM/UI (панель, overlay выбора области, кнопки Сохранить/Отменить). Он не содержит бизнес-логики загрузки или прямого доступа к API расширения.
- `sw.js` (service worker) — единственный источник истины для состояния рабочего процесса (навигация, ожидание выбора, загрузка). Он отправляет команды `SHOW_UI`, `HIDE_UI` и `SHOW_ERROR` в content script.

### Почему необходим service worker
- API вроде `chrome.tabs.captureVisibleTab`, `chrome.tabs.update` и другие доступны только в фоновом контексте расширения. Их нельзя вызывать из content script.

---

## Установка (режим разработчика)

1. Откройте Chrome/Chromium/Edge
2. Перейдите в `chrome://extensions` (или `edge://extensions`)
3. Включите "Режим разработчика"
4. Нажмите "Загрузить распакованное расширение" и выберите папку `ext` (папку с файлом `manifest.json`)

---

## Быстрый тест

После загрузки расширения:
- Нажмите на иконку расширения или используйте механизм активации со страницы (если реализован)
- Появится UI с предложением выбрать область

---

## Команды для разработки

В проекте нет этапа сборки по умолчанию — файлы представляют собой чистый JS. Просто редактируйте файлы в `ext/`.

### Запуск сервера симуляции (опционально)

```bash
cd sim-server
npm install
npm start
```

### Перезагрузка расширения после изменений

В Chrome:
1. Откройте `chrome://extensions`
2. Нажмите "Обновить" рядом с расширением


